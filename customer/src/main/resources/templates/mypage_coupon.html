<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="layout/layout">

<div layout:fragment="content">
    <div class="row margin-section">
        <section class="col-3">
            <th:block th:replace="fragment/myPage :: mypage_top"></th:block>
            <th:block th:replace="fragment/myPage :: mypage_nav_coupon"></th:block>
            <!--            <th:block th:replace="fragment/myPage :: mypage_bottom"></th:block>-->
        </section>
        <section class="col-9">
            <!--            <th:block th:replace="fragment/myPage :: coupon"></th:block>-->
            <div    th:fragment="coupon"
                    class="border bg-white rounded-3 border-2 margin-title padding-16">

                <th:block th:replace="fragment/title :: title_2('나의 쿠폰')"></th:block>

                <!--                <th:block th:replace="fragment/myPage :: couponInsert"></th:block>-->
                <form action="" th:fragment="couponInsert" onsubmit="return getCouponByNum();">

                    <div class="row align-items-end margin-left-8">
                        <label class="col-10">쿠폰 등록
                            <input  type="text" class="form-control" name="num" id="num"></input>
                        </label>

                        <input  class="col-auto btn btn-primary"
                                id="button_solid"
                                value="쿠폰 등록"
                                type="submit"/>

                    </div><!--row-->
                </form>

                <!--카테고리 탭-->
                <ul class="nav nav-tabs margin-bottom-32 margin-top-24">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="mypagecoupon">사용 가능</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link color-gray" href="mypagecoupondisabled">사용 완료</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link color-gray" href="mypagecouponexpired">사용 불가</a>
                    </li>
                </ul>
                <!--카테고리 탭 끝-->

                <div class="row text-align-center margin-top-24 justify-content-center">
                    <table class="col-11" id="couponTable">
                        <thead>
                        <tr>
                            <td>쿠폰명</td>
                            <td>할인 금액</td>
                            <td>사용 조건</td>
                            <td>유효 기간</td>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>

            </div>
        </section>
    </div>

</div>
</html>

<script th:src="@{/js/getcoupon.js}"></script>
<script>
    // 사용 가능 쿠폰 리스트 로드
    document.addEventListener("DOMContentLoaded", function() {
        var couponTable = document.getElementById("couponTable");

        fetch(`${BASE_URL}/api/membercoupons/myavailablecouponlist`, {
            method: 'GET'
        }).then(response => {
            if (response.ok) {
                return response.json();
            }
        }).then(memberCouponList => {
            console.log(memberCouponList)

            /*if(memberCouponList.length < 1){

                couponNull.innerHTML =
                    `<div class="d-flex justify-content-center">
        <svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" fill="currentColor" class="color-gray bi bi-cash" viewBox="0 0 16 16">
            <path d="M8 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/>
            <path d="M0 4a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V4zm3 0a2 2 0 0 1-2 2v4a2 2 0 0 1 2 2h10a2 2 0 0 1 2-2V6a2 2 0 0 1-2-2H3z"/>
        </svg>
    </div>

    <div class="d-flex justify-content-center margin-top-24">
        <span class="color-gray font-size-20">사용 가능한 쿠폰이 없습니다.</span>
    </div>`;
            }*/

            var memberCouponTBody = couponTable.getElementsByTagName("tbody")[0];
            memberCouponTBody.innerHTML = memberCouponList.map(memberCoupon => {
                return `<tr>`
                    + `<td style="width: 32%;white-space: nowrap">${memberCoupon.name}</td>`
                    + `<td style="width: 11%;white-space: nowrap">${memberCoupon.price}</a></td>`
                    + `<td>${memberCoupon.condition}</td>`
                    + `<td style="width: 16%;white-space: nowrap">~${moment(memberCoupon.expiredAt).format(DATE_FORMAT_KOR)}</td>`
                    + `</tr>`
            }).join('');
        });

    });



</script>